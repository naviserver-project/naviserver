# -*- Tcl -*-

package require tcltest 2.2
namespace import -force ::tcltest::*

::tcltest::configure {*}$argv

test ns_striphtml-1.0 {basic test} -body {
    ns_striphtml {hello <b>world</b>}
} -result "hello world"

test ns_striphtml-2.0.1 {nbsp entity} -body {
    ns_striphtml {hello&nbsp;world}
} -result "hello¬†world"
test ns_striphtml-2.0.2 {bare less sign} -body {
    ns_striphtml {hello&lt;world}
} -result "hello<world"
test ns_striphtml-2.0.3 {bare greater sign} -body {
    ns_striphtml {hello&gt;world}
} -result "hello>world"
test ns_striphtml-2.0.4 {two entities next to each other} -body {
    ns_striphtml {&lt;&gt;}
} -result "<>"
test ns_striphtml-2.0.5 {two entities next to each other, embedded} -body {
    ns_striphtml {hello&lt;&gt;world}
} -result "hello<>world"
test ns_striphtml-2.0.6 {with decimal numeric entity} -body {
    ns_striphtml [ns_quotehtml {hello "world"}]
} -result {hello "world"}
test ns_striphtml-2.0.7 {with decomal numeric entity} -body {
    ns_striphtml [ns_quotehtml {hello 'world'}]
} -result "hello 'world'"
test ns_striphtml-2.0.8 {with hex entity} -body {
    ns_striphtml {hello &#x22;world&#x22;}
} -result {hello "world"}

test ns_striphtml-2.0.9 {two entity next to each other} -body {
    ns_striphtml {a&lt;b&lt;&gt;c}
} -result "a<b<>c"
test ns_striphtml-2.0.10 {entity immediately followed by opening tag} -body {
    ns_striphtml {a<a href='h'>b</a>c&amp;<a href='h'>d</a>e}
} -result "abc&de"
test ns_striphtml-2.0.11 {unknown entity} -body {
    ns_striphtml {a&ltxxx;b}
} -result "ab"


test ns_striphtml-2.1 {euro entity} -body {
    ns_striphtml {hello&euro;world}
} -result "hello‚Ç¨world"

test ns_striphtml-2.2 {cent entity} -body {
    ns_striphtml {hello&cent;world}
} -result "hello¬¢world"
test ns_striphtml-2.2b {cent entity} -body {
    ns_striphtml {hello&#162;world}
} -result "hello¬¢world"

test ns_striphtml-2.3 {pound entity} -body {
    ns_striphtml {hello&pound;world}
} -result "hello¬£world"
test ns_striphtml-2.3b {pound numeric entity} -body {
    ns_striphtml {hello&#163;world}
} -result "hello¬£world"

test ns_striphtml-2.4 {yen entity} -body {
    ns_striphtml {hello&yen;world}
} -result "hello¬•world"
test ns_striphtml-2.4b {yen numeric entity} -body {
    ns_striphtml {'hello&#165;world'}
} -result "'hello¬•world'"


test ns_striphtml-3.0 {table} -body {
    set t {
        {"lates",   5, "‚™≠Ô∏Ä",   6},
        
                                {"AElig",   5, "√Ü", 2},
                                {"Aacute",  6, "√Å", 2},
                                {"Acirc",   5, "√Ç", 2},
                                {"Agrave",  6, "√Ä", 2},
                                {"Alpha",   5, "Œë", 2},
                                {"Aring",   5, "√Ö", 2},
                                {"Atilde",  6, "√É", 2},
                                {"Auml",    4, "√Ñ", 2},
                                {"Beta",    4, "Œí", 2},
                                {"Ccedil",  6, "√á", 2},
                                {"Chi",     3, "Œß", 2},
                                {"Delta",   5, "Œî", 2},
                                {"ETH",     3, "√ê", 2},
                                {"Eacute",  6, "√â", 2},
                                {"Ecirc",   5, "√ä", 2},
                                {"Egrave",  6, "√à", 2},
                                {"Epsilon", 7, "Œï", 2},
                                {"Eta",     3, "Œó", 2},
                                {"Euml",    4, "√ã", 2},
                                {"Gamma",   5, "Œì", 2},
                                {"Iacute",  6, "√ç", 2},
                                {"Icirc",   5, "√é", 2},
                                {"Igrave",  6, "√å", 2},
                                {"Iota",    4, "Œô", 2},
                                {"Iuml",    4, "√è", 2},
                                {"Kappa",   5, "Œö", 2},
                                {"Lambda",  6, "Œõ", 2},
                                {"Mu",      2, "Œú", 2},
                                {"Ntilde",  6, "√ë", 2},
                                {"Nu",      2, "Œù", 2},
                                {"Oacute",  6, "√ì", 2},
                                {"Ocirc",   5, "√î", 2},
                                {"Ograve",  6, "√í", 2},
                                {"Omega",   5, "Œ©", 2},
                                {"Omicron", 7, "Œü", 2},
                                {"Oslash",  6, "√ò", 2},
                                {"Otilde",  6, "√ï", 2},
                                {"Ouml",    4, "√ñ", 2},
                                {"Phi",     3, "Œ¶", 2},
                                {"Pi",      2, "Œ†", 2},
                                {"Prime",   5, "‚Ä≥", 2},
                                {"Psi",     3, "Œ®", 2},
                                {"Rho",     3, "Œ°", 2},
                                {"Sigma",   5, "Œ£", 2},
                                {"THORN",   5, "√û", 2},
                                {"Tau",     3, "Œ§", 2},
                                {"Theta",   5, "Œò", 2},
                                {"Uacute",  6, "√ö", 2},
                                {"Ucirc",   5, "√õ", 2},
                                {"Ugrave",  6, "√ô", 2},
                                {"Upsilon", 7, "Œ•", 2},
                                {"Uuml",    4, "√ú", 2},
                                {"Xi",      2, "Œû", 2},
                                {"Yacute",  6, "√ù", 2},
                                {"Zeta",    4, "Œñ", 2},
                                {"aacute",  6, "√°", 2},
                                {"acirc",   5, "√¢", 2},
                                {"acute",   5, "¬¥", 2},
                                {"aelig",   5, "√¶", 2},
                                {"agrave",  6, "√†", 2},
                                {"alefsym", 7, "‚Ñµ", 2},
                                {"alpha",   5, "Œ±", 2},
                                {"amp",     3, "&", 2},
                                {"and",     3, "‚àß", 2},
                                {"ang",     3, "‚à†", 2},
                                {"apos",    4, "'", 1},
                                {"aring",   5, "√•", 2},
                                {"asymp",   5, "‚âà", 2},
                                {"atilde",  6, "√£", 2},
                                {"auml",    4, "√§", 2},
                                {"beta",    4, "Œ≤", 2},
                                {"brvbar",  6, "¬¶", 2},
                                {"bull",    4, "‚Ä¢", 2},
                                {"cap",     3, "‚à©", 2},
                                {"ccedil",  6, "√ß", 2},
                                {"cedil",   5, "¬∏", 2},
                                {"cent",    4, "¬¢", 2},
                                {"chi",     3, "œá", 2},
                                {"clubs",   5, "‚ô£", 2},
                                {"cong",    4, "‚âÖ", 2},
                                {"copy",    4, "¬©", 2},
                                {"crarr",   5, "‚Üµ", 2},
                                {"cup",     3, "‚à™", 2},
                                {"curren",  6, "¬§", 2},
                                {"dArr",    4, "‚áì", 2},
                                {"darr",    4, "‚Üì", 2},
                                {"deg",     3, "¬∞", 2},
                                {"delta",   5, "Œ¥", 2},
                                {"diams",   5, "‚ô¶", 2},
                                {"divide",  6, "√∑", 2},
                                {"eacute",  6, "√©", 2},
                                {"ecirc",   5, "√™", 2},
                                {"egrave",  6, "√®", 2},
                                {"empty",   5, "‚àÖ", 2},
                                {"epsilon", 7, "Œµ", 2},
                                {"equiv",   5, "‚â°", 2},
                                {"eta",     3, "Œ∑", 2},
                                {"eth",     3, "√∞", 2},
                                {"euml",    4, "√´", 2},
                                {"euro",    4, "‚Ç¨", 3},
                                {"exist",   5, "‚àÉ", 2},
                                {"fnof",    4, "∆í", 2},
                                {"forall",  6, "‚àÄ", 2},
                                {"frac12",  6, "¬Ω", 2},
                                {"frac14",  6, "¬º", 2},
                                {"frac34",  6, "¬æ", 2},
                                {"frasl",   5, "‚ÅÑ", 2},
                                {"gamma",   5, "Œ≥", 2},
                                {"ge",      2, "‚â•", 1},
                                {"gt",      2, ">", 1},
                                {"hArr",    4, "‚áî", 2},
                                {"harr",    4, "‚Üî", 2},
                                {"hearts",  6, "‚ô•", 2},
                                {"hellip",  6, "‚Ä¶", 2},
                                {"iacute",  6, "√≠", 2},
                                {"icirc",   5, "√Æ", 2},
                                {"iexcl",   5, "¬°", 2},
                                {"igrave",  6, "√¨", 2},
                                {"image",   5, "‚Ñë", 2},
                                {"infin",   5, "‚àû", 2},
                                {"int",     3, "‚à´", 2},
                                {"iota",    4, "Œπ", 2},
                                {"iquest",  6, "¬ø", 2},
                                {"isin",    4, "‚àà", 2},
                                {"iuml",    4, "√Ø", 2},
                                {"kappa",   5, "Œ∫", 2},
                                {"lArr",    4, "‚áê", 2},
                                {"lambda",  6, "Œª", 2},
                                {"lang",    4, "‚ü®", 2},
                                {"laquo",   5, "¬´", 2},
                                {"larr",    4, "‚Üê", 2},
                                {"lceil",   5, "‚åà", 2},
                                {"le",      2, "‚â§", 2},
                                {"lfloor",  6, "‚åä", 2},
                                {"lowast",  6, "‚àó", 2},
                                {"loz",     3, "‚óä", 2},
                                {"lt",      2, "<", 1},
                                {"macr",    4, "¬Ø", 2},
                                {"micro",   5, "¬µ", 2},
                                {"middot",  6, "¬∑", 2},
                                {"minus",   5, "‚àí", 2},
                                {"mu",      2, "Œº", 2},
                                {"nabla",   5, "‚àá", 2},
                                {"nbsp",    4, "¬†", 2},
                                {"ne",      2, "‚â†", 2},
                                {"ni",      2, "‚àã", 2},
                                {"not",     3, "¬¨", 2},
                                {"notin",   5, "‚àâ", 2},
                                {"nsub",    4, "‚äÑ", 2},
                                {"ntilde",  6, "√±", 2},
                                {"nu",      2, "ŒΩ", 2},
                                {"oacute",  6, "√≥", 2},
                                {"ocirc",   5, "√¥", 2},
                                {"ograve",  6, "√≤", 2},
                                {"oline",   5, "‚Äæ", 2},
                                {"omega",   5, "œâ", 2},
                                {"omicron", 7, "Œø", 2},
                                {"oplus",   5, "‚äï", 2},
                                {"or",      2, "‚à®", 2},
                                {"ordf",    4, "¬™", 2},
                                {"ordm",    4, "¬∫", 2},
                                {"oslash",  6, "√∏", 2},
                                {"otilde",  6, "√µ", 2},
                                {"otimes",  6, "‚äó", 2},
                                {"ouml",    4, "√∂", 2},
                                {"para",    4, "¬∂", 2},
                                {"part",    4, "‚àÇ", 2},
                                {"perp",    4, "‚ä•", 2},
                                {"phi",     3, "œÜ", 2},
                                {"pi",      2, "œÄ", 2},
                                {"piv",     3, "œñ", 2},
                                {"plusmn",  6, "¬±", 2},
                                {"pound",   5, "¬£", 2},
                                {"prime",   5, "‚Ä≤", 1},
                                {"prod",    4, "‚àè", 2},
                                {"prop",    4, "‚àù", 2},
                                {"psi",     3, "œà", 2},
                                {"quot",    4, "\"", 1},
                                {"rArr",    4, "‚áí", 2},
                                {"radic",   5, "‚àö", 2},
                                {"rang",    4, "‚ü©", 2},
                                {"raquo",   5, "¬ª", 2},
                                {"rarr",    4, "‚Üí", 2},
                                {"rceil",   5, "‚åâ", 2},
                                {"real",    4, "‚Ñú", 2},
                                {"reg",     3, "¬Æ", 2},
                                {"rfloor",  6, "‚åã", 2},
                                {"rho",     3, "œÅ", 2},
                                {"sdot",    4, "‚ãÖ", 2},
                                {"sect",    4, "¬ß", 2},
                                {"shy",     3, "¬≠", 2},
                                {"sigma",   5, "œÉ", 2},
                                {"sigmaf",  6, "œÇ", 2},
                                {"sim",     3, "‚àº", 2},
                                {"spades",  6, "‚ô†", 2},
                                {"sub",     3, "‚äÇ", 2},
                                {"sube",    4, "‚äÜ", 2},
                                {"sum",     3, "‚àë", 2},
                                {"sup",     3, "‚äÉ", 2},
                                {"sup1",    4, "¬π", 2},
                                {"sup2",    4, "¬≤", 2},
                                {"sup3",    4, "¬≥", 2},
                                {"supe",    4, "‚äá", 2},
                                {"szlig",   5, "√ü", 2},
                                {"tau",     3, "œÑ", 2},
                                {"there4",  6, "‚à¥", 2},
                                {"theta",   5, "Œ∏", 2},
                                {"thetasym",8, "œë", 2},
                                {"thorn",   5, "√æ", 2},
                                {"times",   5, "√ó", 2},
                                {"trade",   5, "‚Ñ¢", 2},
                                {"uArr",    4, "‚áë", 2},
                                {"uacute",  6, "√∫", 2},
                                {"uarr",    4, "‚Üë", 2},
                                {"ucirc",   5, "√ª", 2},
                                {"ugrave",  6, "√π", 2},
                                {"uml",     3, "¬®", 2},
                                {"upsih",   5, "œí", 2},
                                {"upsilon", 7, "œÖ", 2},
                                {"uuml",    4, "√º", 2},
                                {"weierp",  6, "‚Ñò", 2},
                                {"xi",      2, "Œæ", 2},
                                {"yacute",  6, "√Ω", 2},
                                {"yen",     3, "¬•", 2},
                                {"yuml",    4, "√ø", 2},
                                {"zeta",    4, "Œ∂", 2}
    }
    append t \
        [subst {{"Tab",        3, "\t", 1}}], \n \
        [subst {{"ThickSpace", 10, "\u205F\u200A", 6}}], \n \
        [subst {{"nsce",        4, "\u2AB0\u0338", 6}}] \n \

    
    regsub -all {{NULL,    0, "", 0}} $t "" t
    regsub -all {,} $t " " t
    set string ""
    set expected ""
    foreach l $t {
        lassign $l name len value valueLen
        if {$len ne [string length $name]} {
            ns_log notice "name length $len of <$name> incorrect, should be [string length $name]"
        }
        append string   "&$name; "
        append expected "$value "
    }
    set got [ns_striphtml $string]
    set result [expr {$expected eq $got}]
    if {$result eq 0} {
        #ns_log notice "\nexp: $expected\ngot: $got"
        set p 0
        foreach e [split $expected " "] g [split $got " "] {
            if {$e ne $g} {
                ns_log notice "pos $p: e $e g $g eq [expr {$e eq $g}]"
            }
            incr p
        }
    }
    return $result
} -returnCodes {error return ok} -result "1"

test ns_striphtml-4.0 {strip HTML comment} -body {
    ns_striphtml {hello<!-- SOME COMMENT -->World}
} -result "helloWorld"


#######################################################################################
#  test ns_quotehtml
#######################################################################################

test ns_quotehtml-1.0 {ns_quotehtml with typical value} -body {
    return [ns_quotehtml {<span class="foo">}]
} -result {&lt;span class=&#34;foo&#34;&gt;}

#######################################################################################
#  test ns_unquotehtml
#######################################################################################

test ns_unquotehtml-1.0 {ns_unquotehtml with typical value} -body {
    return [ns_unquotehtml [ns_quotehtml {<span class="foo">...</span>}]]
} -result {<span class="foo">...</span>}

test ns_unquotehtml-1.1 {ns_unquotehtml with typical value} -body {
    return [ns_unquotehtml [ns_quotehtml {aaa<span class='foo'>...</span>zzz}]]
} -result {aaa<span class='foo'>...</span>zzz}

test ns_unquotehtml-1.2 {ns_unquotehtml with named UTF-8 entity} -body {
    return [ns_unquotehtml {a&otimes;b}]
} -result {a‚äób}
test ns_unquotehtml-1.3 {two entities next to each other} -body {
    ns_unquotehtml {&lt;&gt;}
} -result "<>"
test ns_unquotehtml-1.4 {two entities next to each other. embedded} -body {
    ns_unquotehtml {hello&lt;&gt;world}
} -result "hello<>world"


test ns_unquotehtml-2.0 {ns_unquotehtml with numeric entities (US ASCII)} -body {
    ns_unquotehtml {&#104;&#x65;&#108;&#x6C;&#x6F;}
} -result {hello}

test ns_unquotehtml-2.1 {ns_unquotehtml with numeric euro sign as (code point U+20AC)} -body {
    ns_unquotehtml {give me &#x20AC;&#8364;!}
} -result {give me ‚Ç¨‚Ç¨!}

test ns_unquotehtml-2.2 {ns_unquotehtml with mermaids with different skin tones} -body {
    ns_unquotehtml {&#129500;&#127995; Light skin tone; &#129500;&#127998; Medium Dark skin tone.}
} -result {üßúüèª Light skin tone; üßúüèæ Medium Dark skin tone.}


#######################################################################################
#  test ns_parsehtml
#######################################################################################

test ns_parsehtml-1.0 {ns_parsehtml just with tags} -body {
    set text {hello <b>foo</b> anchor <a href="/foo">world</a>.}
    ns_parsehtml $text
} -result {{text {hello }} {tag <b> {b {}}} {text foo} {tag </b> /b} {text { anchor }} {tag {<a href="/foo">} {a {href /foo}}} {text world} {tag </a> /a} {text .}}

test ns_parsehtml-1.1.1 {ns_parsehtml with tags and comment} -body {
    set text {hello <b>foo</b><!-- anchor <a href="/foo">world</a>-->.}
    ns_parsehtml $text
} -result {{text {hello }} {tag <b> {b {}}} {text foo} {tag </b> /b} {comment {<!-- anchor <a href="/foo">world</a>-->}} {text .}}

test ns_parsehtml-1.1.2 {ns_parsehtml -with noangle flag} -body {
    set text {hello <b>foo</b><!-- anchor <a href="/foo">world</a>-->.}
    ns_parsehtml -noangle -- $text
} -result {{text {hello }} {tag b {b {}}} {text foo} {tag /b /b} {comment {!-- anchor <a href="/foo">world</a>--}} {text .}}

test ns_parsehtml-1.1.3 {ns_parsehtml with -onlytags flag} -body {
    set text {hello <b>foo</b><!-- anchor <a href="/foo">world</a>-->.}
    list [ns_parsehtml -onlytags -- $text]
} -result {{{b {}} /b}}

test ns_parsehtml-1.1.4 {ns_parsehtml with -noangle and -onlytags flags} -body {
    set text {hello <b>foo</b><!-- anchor <a href="/foo">world</a>-->.}
    list [ns_parsehtml -noangle -onlytags -- $text]
} -returnCodes error -result {the options '-noangle' and '-onlytags' are mutually exclusive}


test ns_parsehtml-1.2 {ns_parsehtml with tags and comment} -body {
    set text {<input value=yes>}
    ns_parsehtml $text
} -result {{tag {<input value=yes>} {input {value yes}}}}

test ns_parsehtml-1.3 {ns_parsehtml with single quote} -body {
    set text {<input value='yes'>}
    ns_parsehtml $text
} -result {{tag {<input value='yes'>} {input {value yes}}}}

test ns_parsehtml-1.4 {ns_parsehtml with double quote} -body {
    set text {<input value="yes">}
    ns_parsehtml $text
} -result {{tag {<input value="yes">} {input {value yes}}}}

test ns_parsehtml-1.5 {ns_parsehtml without explicit tag value} -body {
    set text {<input disabled>}
    ns_parsehtml $text
} -result {{tag {<input disabled>} {input {disabled {}}}}}

test ns_parsehtml-1.6 {ns_parsehtml with double quote and single quote} -body {
    set text {<input aa="yes" cc='maybe'>}
    ns_parsehtml $text
} -result {{tag {<input aa="yes" cc='maybe'>} {input {aa yes cc maybe}}}}

test ns_parsehtml-1.7 {ns_parsehtml tag with multiple notations} -body {
    set text {<input aa="yes" bb=no cc='maybe'>}
    ns_parsehtml $text
} -result {{tag {<input aa="yes" bb=no cc='maybe'>} {input {aa yes bb no cc maybe}}}}

test ns_parsehtml-1.8.0 {ns_parsehtml tag with multiple notations} -body {
    set text {<input disabled a="yes" b=no c='maybe'>}
    ns_parsehtml $text
} -result {{tag {<input disabled a="yes" b=no c='maybe'>} {input {disabled {} a yes b no c maybe}}}}

test ns_parsehtml-1.8.1 {ns_parsehtml tag with multiple notations with whitespace} -body {
    set text {<input  disabled  a = "yes" b = no   c = 'maybe'  >}
    ns_parsehtml $text
} -result {{tag {<input  disabled  a = "yes" b = no   c = 'maybe'  >} {input {disabled {} a yes b no c maybe}}}}

test ns_parsehtml-1.9 {ns_parsehtml with tabs with colons} -body {
    set text {this is a file <adp:icon name="file"> icon}
    ns_parsehtml $text
} -result {{text {this is a file }} {tag {<adp:icon name="file">} {adp:icon {name file}}} {text { icon}}}

test ns_parsehtml-1.10.1 {ns_parsehtml free standing less character with space} -body {
    set text {a < b}
    ns_parsehtml $text
} -result {{text {a < b}}}
test ns_parsehtml-1.10.2 {ns_parsehtml free standing less character without space} -body {
    set text {a<b}
    ns_parsehtml $text
} -result {{text a<b}}

test ns_parsehtml-2.0.0 {ns_parsehtml with tags ending with "="} -body {
    set text {<input att=>}
    ns_parsehtml $text
} -result {{tag {<input att=>} {input {att {}}}}}

test ns_parsehtml-2.0.1 {ns_parsehtml with tags ending with "=" plus spaces} -body {
    set text {<input att = >}
    ns_parsehtml $text
} -result {{tag {<input att = >} {input {att {}}}}}

test ns_parsehtml-2.1.0 {ns_parsehtml tag is not closed} -body {
    set text {a <input att}
    ns_parsehtml $text
} -result {{text {a <input att}}}

test ns_parsehtml-2.1.1 {ns_parsehtml tag is not closed} -body {
    set text {<input att}
    ns_parsehtml $text
} -result {{text {<input att}}}

test ns_parsehtml-2.2 {ns_parsehtml attribute quotes are not closed} -body {
    set text {a <input att='123>}
    ns_parsehtml $text
} -result {{text {a }} {text {<input att='123>}}}

test ns_parsehtml-2.3 {ns_parsehtml tag is closed inside the quotes} -body {
    set text {a <input att='123>'}
    ns_parsehtml $text
} -result {{text {a }} {text {<input att='123>}} {text '}}

test ns_parsehtml-2.4 {ns_parsehtml with non-closed comment - interpreted as text} -body {
    set text {a <--input att='123>'}
    ns_parsehtml $text
} -result {{text {a }} {text {<--input att='123>'}}}

test ns_parsehtml-2.5 {ns_parsehtml with pi} -body {
    set text {a <?xml version="1.0" encoding="UTF-8" ?> b}
    ns_parsehtml $text
} -result {{text {a }} {pi {<?xml version="1.0" encoding="UTF-8" ?>}} {text { b}}}

test ns_parsehtml-2.6 {ns_parsehtml with non-closed pi - interpreted as text} -body {
    set text {a <?xml version="1.0" encoding="UTF-8" ? b}
    ns_parsehtml $text
} -result {{text {a <?xml version="1.0" encoding="UTF-8" ? b}}}


test ns_parsehtml-3.1 {ns_parsehtml empty tag} -body {
    set text {a <> b}
    ns_parsehtml $text
} -result {{text {a }} {text {<> b}}}

test ns_parsehtml-3.2 {ns_parsehtml empty tag} -body {
    set text {a < > b}
    ns_parsehtml $text
} -result {{text {a < > b}}}

test ns_parsehtml-3.3 {ns_parsehtml empty tag} -body {
    set text {a <}
    ns_parsehtml $text
} -result {{text {a <}}}

test ns_parsehtml-3.4.1 {ns_parsehtml empty tag} -body {
    set text {a <br /> b}
    ns_parsehtml $text
} -result {{text {a }} {tag {<br />} {br {}}} {text { b}}}
test ns_parsehtml-3.4.2 {ns_parsehtml empty tag} -body {
    set text {a <br/> b}
    ns_parsehtml $text
} -result {{text {a }} {tag <br/> {br {}}} {text { b}}}
test ns_parsehtml-3.4.3 {ns_parsehtml empty tag} -body {
    set text {a <br /> b}
    ns_parsehtml $text
} -result {{text {a }} {tag {<br />} {br {}}} {text { b}}}

test ns_parsehtml-3.5 {ns_parsehtml funny tag name} -body {
    set text {foo <t'x> bar}
    ns_parsehtml $text
} -result {{text {foo }} {text <t'x>} {text { bar}}}

test ns_parsehtml-3.6 {ns_parsehtml containing text with multi-byte characters} -body {
    set text {foo ¬´ <p> ¬ª bar}
    ns_parsehtml $text
} -result {{text {foo ¬´ }} {tag <p> {p {}}} {text { ¬ª bar}}}

#
# Local variables:
#    mode: tcl
#    tcl-indent-level: 4
#    indent-tabs-mode: nil
# End:
